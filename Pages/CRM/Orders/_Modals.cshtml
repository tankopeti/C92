
@using Microsoft.AspNetCore.Mvc.Rendering
@using Cloud9_2.Models
@using System.Globalization
@model Cloud9_2.Pages.CRM.Orders.IndexModel
@using Microsoft.AspNetCore.Antiforgery



@foreach (var order in Model.Orders)
{

<!-- Edit Order Modal -->
@* <div class="modal fade" id="editOrderModal_@order.OrderId" tabindex="-1" aria-labelledby="editOrderModalLabel_@order.OrderId" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editOrderModalLabel_@order.OrderId">Rendelés szerkesztése: @(order.OrderNumber ?? "N/A")</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Tabs -->
                <ul class="nav nav-tabs" id="orderTabs_@order.OrderId" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="base-info-tab_@order.OrderId" data-bs-toggle="tab" data-bs-target="#base-info_@order.OrderId" type="button" role="tab" aria-controls="base-info_@order.OrderId" aria-selected="true">Alapadatok</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="items-tab_@order.OrderId" data-bs-toggle="tab" data-bs-target="#items_@order.OrderId" type="button" role="tab" aria-controls="items_@order.OrderId" aria-selected="false">Tételek</button>
                    </li>
                </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="orderTabContent_@order.OrderId">
                <!-- Base Info Tab -->
                <div class="tab-pane fade show active" id="base-info_@order.OrderId" role="tabpanel" aria-labelledby="base-info-tab_@order.OrderId">
                    <form id="orderBaseInfoForm_@order.OrderId">
                        @Html.AntiForgeryToken()
                        <table class="table table-sm mt-3">
                            <tbody>
                                <tr>
                                    <th>Rendelésszám</th>
                                    <td><input type="text" class="form-control" name="OrderNumber" value="@order.OrderNumber" readonly></td>
                                </tr>
                                <tr>
                                    <th>Rendelés dátuma</th>
                                    <td><input type="date" class="form-control" name="OrderDate" value="@(order.OrderDate?.ToString("yyyy-MM-dd"))" required></td>
                                </tr>
                                <tr>
                                    <th>Határidő</th>
                                    <td><input type="date" class="form-control" name="Deadline" value="@(order.Deadline?.ToString("yyyy-MM-dd"))"></td>
                                </tr>
                                <tr>
                                    <th>Partner</th>
                                    <td>
                                        <select name="PartnerId" id="partner-select_@order.OrderId" class="form-select tom-select" 
                                                data-selected-id="@order.PartnerId" 
                                                data-selected-text="@(order.Partner?.Name ?? "")" 
                                                autocomplete="off">
                                            <option value="">-- Válasszon partnert --</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Telephely</th>
                                    <td>
                                        <select name="SiteId" id="site-select_@order.OrderId" class="form-select tom-select" 
                                                data-selected-id="@order.SiteId" 
                                                data-selected-text="@(order.Site?.AddressLine1 ?? "")" 
                                                autocomplete="off">
                                            <option value="">-- Válasszon telephelyet --</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Pénznem</th>
                                <td>
                                    <select name="CurrencyId" class="form-select tom-select" data-selected-id="@order.CurrencyId" data-selected-text="@(order.Currency?.CurrencyName ?? "")" autocomplete="off">
                                        <option value="" disabled selected>-- Válasszon pénznemet --</option>
                                    </select>
                                </td>
                                </tr>
                                <tr>
                                    <th>Státusz</th>
                                    <td>
                                        <select class="form-select" name="Status" required>
                                            @foreach (var status in Model.StatusDisplayNames)
                                            {
                                                <option value="@status.Key" selected="@(order.Status == status.Key)">@status.Value</option>
                                            }
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Értékesítő</th>
                                    <td><input type="text" class="form-control" name="SalesPerson" value="@order.SalesPerson"></td>
                                </tr>
                                <tr>
                                    <th>Szállítási dátum</th>
                                    <td><input type="date" class="form-control" name="DeliveryDate" value="@(order.DeliveryDate?.ToString("yyyy-MM-dd"))"></td>
                                </tr>
                                <tr>
                                    <th>Cégnév</th>
                                    <td><input type="text" class="form-control" name="CompanyName" value="@order.CompanyName"></td>
                                </tr>
                                <tr>
                                    <th>Tárgy</th>
                                    <td><input type="text" class="form-control" name="Subject" value="@order.Subject"></td>
                                </tr>
                                <tr>
                                    <th>Fizetési feltételek</th>
                                    <td><input type="text" class="form-control" name="PaymentTerms" value="@order.PaymentTerms"></td>
                                </tr>
                                <tr>
                                    <th>Szállítási mód</th>
                                    <td><input type="text" class="form-control" name="ShippingMethod" value="@order.ShippingMethod"></td>
                                </tr>
                                <tr>
                                    <th>Rendelés típusa</th>
                                    <td><input type="text" class="form-control" name="OrderType" value="@order.OrderType"></td>
                                </tr>
                                <tr>
                                    <th>Hivatkozási szám</th>
                                    <td><input type="text" class="form-control" name="ReferenceNumber" value="@order.ReferenceNumber"></td>
                                </tr>
                                <tr>
                                    <th>Árajánlat</th>
                                <td>
                                    <select name="QuoteId" class="form-select tom-select" data-selected-id="@order.QuoteId" data-selected-text="@(order.Quote?.QuoteNumber ?? "")" autocomplete="off">
                                        <option value=""></option>
                                    </select>
                                </td>
                                </tr>
                                <tr>
                                    <th>Kedvezmény (%)</th>
                                    <td><input type="number" step="0.01" min="0" max="100" class="form-control" name="DiscountPercentage" value="@(order.DiscountPercentage?.ToString("F2", CultureInfo.InvariantCulture))"></td>
                                </tr>
                                <tr>
                                    <th>Kedvezmény összege</th>
                                    <td><input type="number" step="0.01" min="0" class="form-control" name="DiscountAmount" value="@(order.DiscountAmount?.ToString("F2", CultureInfo.InvariantCulture))"></td>
                                </tr>
                                <tr>
                                    <th>Összesen</th>
                                    <td><input type="number" step="0.01" class="form-control" name="TotalAmount" value="@(order.TotalAmount?.ToString("F2", CultureInfo.InvariantCulture))" required></td>
                                </tr>
                                <tr>
                                    <th>Leírás</th>
                                    <td><textarea class="form-control" name="Description" rows="4" maxlength="1000">@order.Description</textarea></td>
                                </tr>
                                <tr>
                                    <th>Részletes leírás</th>
                                    <td><textarea class="form-control" name="DetailedDescription" rows="6" maxlength="2000">@order.DetailedDescription</textarea></td>
                                </tr>
                            </tbody>
                        </table>
                    </form>
                </div>

                <!-- Items Tab (unchanged) -->
                <div class="tab-pane fade" id="items_@order.OrderId" role="tabpanel" aria-labelledby="items-tab_@order.OrderId">
                    <button type="button" class="btn btn-primary mb-3 add-item-row" data-order-id="@order.OrderId">Tétel hozzáadása</button>
                    <form id="orderItemsForm_@order.OrderId" data-order-id="@order.OrderId">
                        <input type="hidden" name="__RequestVerificationToken" value=@Html.AntiForgeryToken()/>
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th style="width: 30%;">Termék</th>
                                    <th style="width: 15%;">Mennyiség</th>
                                    <th style="width: 15%;">Egységár</th>
                                    <th style="width: 20%;">Kedvezmény</th>
                                    <th style="width: 15%;">Kedvezmény összeg</th>
                                    <th style="width: 15%;">Nettó egységár</th>
                                    <th style="width: 15%;">ÁFA</th>
                                    <th style="width: 15%;">Nettó összeg</th>
                                    <th style="width: 15%;">Bruttó összeg</th>
                                    <th style="width: 15%;">Műveletek</th>
                                    <th style="width: 5%;"></th>
                                </tr>
                            </thead>
                            <tbody id="items-tbody_@order.OrderId">
                                @foreach (var item in order.OrderItems)
                                {
                                    <script>console.log('Server-side item ID:', '@item.OrderItemId', 'ProductId:', '@item.ProductId');</script>
                                    <tr class="order-item-row" data-item-id="@item.OrderItemId">
                                        <td>
                                            <select name="orderItems[@item.OrderItemId].ProductId" class="form-select tom-select-product" data-selected-id="@item.ProductId" data-selected-text="@(item.Product?.Name ?? "")" autocomplete="off" required>
                                                <option value="" disabled selected>-- Válasszon terméket --</option>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="number" name="orderItems[@item.OrderItemId].Quantity" class="form-control form-control-sm quantity" value="@item.Quantity.ToString(CultureInfo.InvariantCulture)" min="0" step="1" required>
                                        </td>
                                        <td>
                                            <input type="number" name="orderItems[@item.OrderItemId].UnitPrice" class="form-control form-control-sm unit-price" value="@item.UnitPrice.ToString(CultureInfo.InvariantCulture)" min="0" step="0.01" required>
                                        </td>
                                        <td>
                                            <div class="input-group input-group-sm">
                                                <input type="text" name="@(item.DiscountPercentage != null ? $"orderItems[{item.OrderItemId}].DiscountPercentage" : $"orderItems[{item.OrderItemId}].DiscountAmount")" class="form-control discount-value" value="@(item.DiscountPercentage != null ? item.DiscountPercentage : item.DiscountAmount)" placeholder="pl. 10">
                                                <select class="form-select discount-type" data-discount-name-prefix="orderItems[@item.OrderItemId]">
                                                    @if (item.DiscountPercentage != null)
                                                    {
                                                        <option value="Percentage" selected>%</option>
                                                        <option value="Amount">Összeg</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="Percentage">%</option>
                                                        <option value="Amount" selected>Összeg</option>
                                                    }
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="total-price">@((item.Quantity * item.UnitPrice).ToString("F2", CultureInfo.InvariantCulture))</span>
                                            <input type="hidden" name="orderItems[@item.OrderItemId].Description" class="item-description" value="@(item.Description ?? "")">
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-outline-secondary btn-sm edit-description" data-item-id="@item.OrderItemId"><i class="bi bi-pencil"></i></button>
                                            <button type="button" class="btn btn-danger btn-sm remove-item-row"><i class="bi bi-trash"></i></button>
                                        </td>
                                    </tr>
                                    <tr class="description-row" data-item-id="@item.OrderItemId" style="display: none;">
                                        <td colspan="6">
                                            <div class="mb-2">
                                                <label class="form-label">Leírás (max 200 karakter)</label>
                                                <textarea name="orderItems[@item.OrderItemId].DescriptionInput" class="form-control form-control-sm item-description" maxlength="200" rows="2">@(item.Description ?? "")</textarea>
                                                <div class="form-text">Karakterek: <span class="char-count">@((item.Description?.Length ?? 0))</span>/200</div>
                                            </div>
                                        </td>
                                    </tr>
                                }
                                <!-- Order Total Row -->
                                <tr class="order-total-row">
                                    <td colspan="3"></td>
                                    <td><strong>Összesen:</strong></td>
                                    <td><span class="order-total-amount">0.00</span></td>
                                    <td></td>
                                </tr>
                                <tr class="order-discount-row">
                                    <td colspan="3"></td>
                                    <td><strong>Kedvezményes ár:</strong></td>
                                    <td><span class="order-final-total">0.00</span></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bezár</button>
            <button type="button" class="btn btn-primary save-order" data-order-id="@order.OrderId">Mentés</button>
        </div>
    </div>
    </div>
</div>

    <!-- View Order Modal -->
    <div class="modal fade" id="viewOrderModal_@order.OrderId" tabindex="-1" aria-labelledby="viewOrderModalLabel_@order.OrderId" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewOrderModalLabel_@order.OrderId">Részletek: @(order.OrderNumber ?? "Nincs megadva")</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Bezárás"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-sm">
                        <tbody>
                            <tr>
                                <th>Rendelésszám</th>
                                <td class="order-number">@(order.OrderNumber ?? "Nincs megadva")</td>
                            </tr>
                            <tr>
                                <th>Rendelés azonosító</th>
                                <td>@order.OrderId</td>
                            </tr>
                            <tr>
                                <th>Rendelés dátuma</th>
                                <td>@(order.OrderDate?.ToString("yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture) ?? "Nincs megadva")</td>
                            </tr>
                            <tr>
                                <th>Határidő</th>
                                <td>@(order.Deadline?.ToString("yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture) ?? "Nincs megadva")</td>
                            </tr>
                            <tr>
                                <th>Szállítási dátum</th>
                                <td>@(order.DeliveryDate?.ToString("yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture) ?? "Nincs megadva")</td>
                            </tr>
                            <tr>
                                <th>Partner</th>
                                <td>@(order.Partner?.Name ?? "Nincs partner megadva")</td>
                            </tr>
                            <tr>
                                <th>Pénznem</th>
                                <td>@(order.Currency?.CurrencyName ?? "Nincs pénznem megadva")</td>
                            </tr>
                            <tr>
                                <th>Telephely</th>
                                <td>@(order.SiteId.HasValue ? order.SiteId.ToString() : "Nincs megadva")</td>
                            </tr>
                            <tr>
                                <th>Árajánlat azonosító</th>
                                <td>@(order.QuoteId.HasValue ? order.QuoteId.ToString() : "Nincs megadva")</td>
                            </tr>
                            <tr>
                                <th>Hivatkozási szám</th>
                                <td>@(string.IsNullOrEmpty(order.ReferenceNumber) ? "Nincs megadva" : order.ReferenceNumber)</td>
                            </tr>
                            <tr>
                                <th>Rendelés típusa</th>
                                <td>@(string.IsNullOrEmpty(order.OrderType) ? "Nincs megadva" : order.OrderType)</td>
                            </tr>
                            <tr>
                                <th>Cégnév</th>
                                <td>@(string.IsNullOrEmpty(order.CompanyName) ? "Nincs megadva" : order.CompanyName)</td>
                            </tr>
                            <tr>
                                <th>Státusz</th>
                                <td>@(Model.StatusDisplayNames.ContainsKey(order.Status) ? Model.StatusDisplayNames[order.Status] : "Ismeretlen")</td>
                            </tr>
                            <tr>
                                <th>Összesen</th>
                                <td>@(order.TotalAmount?.ToString("N2", System.Globalization.CultureInfo.GetCultureInfo("hu-HU")) ?? "0,00") Ft</td>
                            </tr>
                            <tr>
                                <th>Kedvezmény százaléka</th>
                                <td>@(order.DiscountPercentage.HasValue ? $"{order.DiscountPercentage.Value:N2}%" : "0,00%")</td>
                            </tr>
                            <tr>
                                <th>Kedvezmény összege</th>
                                <td>@(order.DiscountAmount?.ToString("N2", System.Globalization.CultureInfo.GetCultureInfo("hu-HU")) ?? "0,00") Ft</td>
                            </tr>
                            <tr>
                                <th>Fizetési feltételek</th>
                                <td>@(string.IsNullOrEmpty(order.PaymentTerms) ? "Nincs megadva" : order.PaymentTerms)</td>
                            </tr>
                            <tr>
                                <th>Szállítási mód</th>
                                <td>@(string.IsNullOrEmpty(order.ShippingMethod) ? "Nincs megadva" : order.ShippingMethod)</td>
                            </tr>
                            <tr>
                                <th>Értékesítő</th>
                                <td>@(string.IsNullOrEmpty(order.SalesPerson) ? "Nincs megadva" : order.SalesPerson)</td>
                            </tr>
                            <tr>
                                <th>Tárgy</th>
                                <td>@(string.IsNullOrEmpty(order.Subject) ? "Nincs megadva" : order.Subject)</td>
                            </tr>
                            <tr>
                                <th>Leírás</th>
                                <td>@(string.IsNullOrEmpty(order.Description) ? "Nincs megadva" : order.Description)</td>
                            </tr>
                            <tr>
                                <th>Részletes leírás</th>
                                <td>@(string.IsNullOrEmpty(order.DetailedDescription) ? "Nincs megadva" : order.DetailedDescription)</td>
                            </tr>
                            <tr>
                                <th>Létrehozta</th>
                                <td>@(string.IsNullOrEmpty(order.CreatedBy) ? "Nincs megadva" : order.CreatedBy)</td>
                            </tr>
                            <tr>
                                <th>Létrehozás dátuma</th>
                                <td>@(order.CreatedDate?.ToString("yyyy-MM-dd HH:mm:ss", System.Globalization.CultureInfo.InvariantCulture) ?? "Nincs megadva")</td>
                            </tr>
                            <tr>
                                <th>Módosította</th>
                                <td>@(string.IsNullOrEmpty(order.ModifiedBy) ? "Nincs megadva" : order.ModifiedBy)</td>
                            </tr>
                            <tr>
                                <th>Módosítás dátuma</th>
                                <td>@(order.ModifiedDate?.ToString("yyyy-MM-dd HH:mm:ss", System.Globalization.CultureInfo.InvariantCulture) ?? "Nincs megadva")</td>
                            </tr>
                        </tbody>
                    </table>

                    <h5 class="mt-4">Tételek</h5>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Termék ID</th>
                                <th>Termék</th>
                                <th>Leírás</th>
                                <th>Mennyiség</th>
                                <th>Egységár</th>
                                <th>Kedvezmény</th>
                                <th>Összesen</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (order.OrderItems != null && order.OrderItems.Any())
                            {
                                @foreach (var orderItem in order.OrderItems)
                                {
                                    <tr data-item-id="@orderItem.OrderItemId">
                                        <td>@(orderItem.ProductId > 0 ? orderItem.ProductId.ToString() : "Nincs megadva")</td>
                                        <td>@(orderItem.Product?.Name ?? "Ismeretlen termék")</td>
                                        <td>@(string.IsNullOrEmpty(orderItem.Description) ? "Nincs megadva" : orderItem.Description)</td>
                                        <td>@(orderItem.Quantity > 0 ? orderItem.Quantity.ToString("N2", System.Globalization.CultureInfo.GetCultureInfo("hu-HU")) : "0,00")</td>
                                        <td>@orderItem.UnitPrice.ToString("N2", System.Globalization.CultureInfo.GetCultureInfo("hu-HU")) Ft</td>
                                        <td>
                                            @(orderItem.DiscountPercentage.HasValue && orderItem.DiscountPercentage.Value > 0
                                                ? $"{orderItem.DiscountPercentage.Value:N2}%"
                                                : orderItem.DiscountAmount.HasValue && orderItem.DiscountAmount.Value > 0
                                                    ? $"{orderItem.DiscountAmount.Value:N2} Ft"
                                                    : "0,00")
                                        </td>
                                        <td>
                                            @((orderItem.Quantity * orderItem.UnitPrice - (orderItem.DiscountAmount ?? (orderItem.DiscountPercentage.HasValue ? (orderItem.Quantity * orderItem.UnitPrice * orderItem.DiscountPercentage.Value / 100) : 0))).ToString("N2", System.Globalization.CultureInfo.GetCultureInfo("hu-HU"))) Ft
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="7" class="text-center">Nincsenek tételek.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Bezárás">Bezárás</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Order Modal -->
    <div class="modal fade" id="deleteOrderModal_@order.OrderId" tabindex="-1" aria-labelledby="deleteOrderModalLabel_@order.OrderId" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteOrderModalLabel_@order.OrderId">Rendelés törlése</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Bezárás"></button>
                </div>
                <div class="modal-body">
                    <form id="deleteOrderForm_@order.OrderId" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="orderId" value="@order.OrderId" autocomplete="off" />
                        <p>Biztosan törölni szeretné a következő rendelést: <strong>@order.OrderNumber</strong>?</p>
                        <div id="deleteWarning_@order.OrderId" class="alert alert-warning" style="display: none;">
                            Ez a rendelés nem törölhető, mert kapcsolódó rekordok léteznek.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Mégse">Mégse</button>
                    <button type="button" class="btn btn-danger confirm-delete-order" data-order-id="@order.OrderId" aria-label="Rendelés törlése">Törlés</button>
                </div>
            </div>
        </div>
    </div> *@
}

<!-- New Order Modal -->
<div class="modal fade" id="newOrderModal" tabindex="-1" aria-labelledby="newOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newOrderModalLabel">Új rendelés létrehozása</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Tabs -->
                <ul class="nav nav-tabs" id="orderTabs_new" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="base-info-tab_new" data-bs-toggle="tab" data-bs-target="#base-info_new" type="button" role="tab" aria-controls="base-info_new" aria-selected="true">Alapadatok</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="items-tab_new" data-bs-toggle="tab" data-bs-target="#items_new" type="button" role="tab" aria-controls="items_new" aria-selected="false">Tételek</button>
                    </li>
                </ul>
                <!-- Tab Content -->
                <div class="tab-content" id="orderTabContent_new">
                    <!-- Base Info Tab -->
                    <div class="tab-pane fade show active" id="base-info_new" role="tabpanel" aria-labelledby="base-info-tab_new">
                        <form id="orderBaseInfoForm_new">
                            <!-- Hidden Fields -->
                            <input type="hidden" name="createdBy" value="System">
                            <input type="hidden" name="createdDate" value="@DateTime.UtcNow.ToString("yyyy-MM-ddTHH:mm:ss")">
                            <input type="hidden" name="modifiedBy" value="System">
                            <input type="hidden" name="modifiedDate" value="@DateTime.UtcNow.ToString("yyyy-MM-ddTHH:mm:ss")">
                            <!-- General Section -->
                            <h6 class="mt-3">Általános adatok</h6>
                            <table class="table table-sm">
                                <tbody>
                                    <tr>
                                        <th>Rendelésszám</th>
                                        <td><input type="text" class="form-control" name="orderNumber" value="@Model.NextOrderNumber" placeholder="Automatikusan generálódik" readonly></td>
                                    </tr>
                                    <tr>
                                        <th>Rendelés dátuma</th>
                                        <td><input type="date" class="form-control" name="orderDate" value="@DateTime.Today.ToString("yyyy-MM-dd")" required></td>
                                    </tr>
                                    <tr>
                                        <th>Határidő</th>
                                        <td><input type="date" class="form-control" name="deadline"></td>
                                    </tr>
                                    <tr>
                                        <th>Szállítási dátum</th>
                                        <td><input type="date" class="form-control" name="deliveryDate"></td>
                                    </tr>
                                    <tr>
                                        <th>Referenciaszám</th>
                                        <td><input type="text" class="form-control" name="referenceNumber" maxlength="100"></td>
                                    </tr>
                                    <tr>
                                        <th>Rendelés típusa</th>
                                        <td><input type="text" class="form-control" name="orderType" maxlength="50"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- Partner Section -->
                            <h6>Partner adatok</h6>
                            <table class="table table-sm">
                                <tbody>
                                    <tr>
                                    <th>Partner</th>
                                            <td>
                                                <select name="PartnerId" id="partner-select_new" class="form-select tom-select" autocomplete="off">
                                                    <option value="">-- Válasszon partnert --</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Telephely</th>
                                            <td>
                                                <select name="SiteId" id="site-select_new" class="form-select tom-select" autocomplete="off">
                                                    <option value="">-- Válasszon telephelyet --</option>
                                                </select>
                                            </td>
                                        </tr>
                                    <tr>
                                        <th>Cég neve</th>
                                        <td><input type="text" class="form-control" name="companyName" maxlength="100"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- Financial Section -->
                            <h6>Pénzügyi adatok</h6>
                            <table class="table table-sm">
                                <tbody>
                                    <tr>
                                        <th>Pénznem</th>
                                        <td>
                                            <select id="currency-select_new" name="currencyId" class="form-select tom-select" data-selected-id="" data-selected-text="" autocomplete="off" required>
                                                <option value="" disabled selected>-- Válasszon pénznemet --</option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Összesen</th>
                                        <td><input type="number" step="0.01" class="form-control" name="totalAmount" value="" required></td>
                                    </tr>
                                    <tr>
                                        <th>Kedvezmény %</th>
                                        <td><input type="number" step="0.1" min="0" max="100" class="form-control" name="discountPercentage"></td>
                                    </tr>
                                    <tr>
                                        <th>Kedvezmény összeg</th>
                                        <td><input type="number" step="0.01" class="form-control" name="discountAmount"></td>
                                    </tr>
                                    <tr>
                                        <th>Fizetési feltételek</th>
                                        <td><input type="text" class="form-control" name="paymentTerms" maxlength="100"></td>
                                    </tr>
                                    <tr>
                                        <th>Szállítási mód</th>
                                        <td><input type="text" class="form-control" name="shippingMethod" maxlength="100"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- Additional Info Section -->
                            <h6>További adatok</h6>
                            <table class="table table-sm">
                                <tbody>
                                    <tr>
                                        <th>Státusz</th>
                                        <td>
                                            <select class="form-select" name="status" required>
                                                @foreach (var status in Model.StatusDisplayNames)
                                                {
                                                    <option value="@status.Key" selected="@(status.Key == "Pending" ? "selected" : "")">@status.Value</option>
                                                }
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Értékesítő</th>
                                        <td><input type="text" class="form-control" name="salesPerson" maxlength="100"></td>
                                    </tr>
                                    <tr>
                                        <th>Árajánlat azonosító</th>
                                        <td>
                                            <select id="quote-select_new" name="quoteId" class="form-select tom-select" data-selected-id="" data-selected-text="" autocomplete="off">
                                                <option value="" disabled selected>-- Válasszon árajánlatot --</option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Tárgy</th>
                                        <td><input type="text" class="form-control" name="subject" maxlength="200"></td>
                                    </tr>
                                    <tr>
                                        <th>Leírás</th>
                                        <td><textarea class="form-control" name="description" maxlength="500" rows="3"></textarea></td>
                                    </tr>
                                    <tr>
                                        <th>Részletes leírás</th>
                                        <td><textarea class="form-control" name="detailedDescription" rows="5"></textarea></td>
                                    </tr>
                                </tbody>
                            </table>
                        </form>
                    </div>
                    <!-- Items Tab -->
                    <div class="tab-pane fade" id="items_new" role="tabpanel" aria-labelledby="items-tab_new">
                        <button type="button" class="btn btn-primary mb-3 add-item-row" data-order-id="new">Tétel hozzáadása</button>
                        <form id="newOrderForm" method="post" action="/Orders/Create">
                            <!-- Hidden fields for totals -->
                            <input type="hidden" name="TotalNet" class="order-total-net-input" value="0">
                            <input type="hidden" name="TotalVat" class="order-vat-amount-input" value="0">
                            <input type="hidden" name="TotalGross" class="order-gross-amount-input" value="0">
                            <div class="table-responsive">
                                <table class="table table-sm table-bordered" id="orderItemsTable">
                                    <thead>
                                        <tr>
                                            <th style="width: 25%;">Termék</th>
                                            <th style="width: 5%;">Mennyiség</th>
                                            <th style="width: 10%;">Listaár</th>
                                            <th style="width: 10%;">Kedvezmény típus</th>
                                            <th style="width: 10%;">Kedvezmény összege</th>
                                            <th style="width: 10%;">Nettó egységár</th>
                                            <th style="width: 5%;">ÁFA</th>
                                            <th style="width: 10%;">Nettó összes ár</th>
                                            <th style="width: 10%;">Bruttó ár</th>
                                            <th style="width: 5%;">Műveletek</th>
                                        </tr>
                                    </thead>
                                    <tbody id="items-tbody_new">
                                        <!-- Order Total Row -->
                                        <tr class="order-total-row">
                                            <td colspan="5" class="text-end"><strong>Összesen Nettó:</strong></td>
                                            <td><span class="order-total-net">0.00</span></td>
                                            <td colspan="3"></td>
                                        </tr>
                                        <tr class="order-vat-row">
                                            <td colspan="5" class="text-end"><strong>Összes ÁFA:</strong></td>
                                            <td><span class="order-vat-amount">0.00</span></td>
                                            <td colspan="3"></td>
                                        </tr>
                                        <tr class="order-gross-row">
                                            <td colspan="5" class="text-end"><strong>Összesen Bruttó:</strong></td>
                                            <td><span class="order-gross-amount">0.00</span></td>
                                            <td colspan="3"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bezár</button>
                <button type="button" class="btn btn-primary" id="saveOrderBtn_new">Mentés</button>
            </div>
        </div>
    </div>
</div>