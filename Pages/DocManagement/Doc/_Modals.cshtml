@model Cloud9_2.Models.DocumentDto
@using Cloud9_2.Models

<div class="modal fade" id="viewDocumentModal_@Model.DocumentId" tabindex="-1" aria-labelledby="viewDocumentModalLabel_@Model.DocumentId" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewDocumentModalLabel_@Model.DocumentId">Dokumentum részletei - @Model.DocumentId</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Bezárás"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs" id="documentTab_@Model.DocumentId" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="details-tab_@Model.DocumentId" data-bs-toggle="tab" data-bs-target="#details_@Model.DocumentId" type="button" role="tab" aria-controls="details_@Model.DocumentId" aria-selected="true">Részletek</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="history-tab_@Model.DocumentId" data-bs-toggle="tab" data-bs-target="#history_@Model.DocumentId" type="button" role="tab" aria-controls="history_@Model.DocumentId" aria-selected="false">Változási napló</button>
                    </li>
                </ul>
                <div class="tab-content" id="documentTabContent_@Model.DocumentId">
                    <!-- Details Tab -->
                    <div class="tab-pane fade show active" id="details_@Model.DocumentId" role="tabpanel" aria-labelledby="details-tab_@Model.DocumentId">
                        <dl class="row mt-3">
                            <dt class="col-sm-3">Dokumentum ID</dt>
                            <dd class="col-sm-9">@Model.DocumentId</dd>
                            <dt class="col-sm-3">Fájlnév</dt>
                            <dd class="col-sm-9"><a href="/file/@Model.DocumentId" target="_blank">@Model.FileName</a></dd>
                            <dt class="col-sm-3">Partner</dt>
                            <dd class="col-sm-9">@Model.PartnerName</dd>
                            <dt class="col-sm-3">Feltöltés dátuma</dt>
                            <dd class="col-sm-9">@(Model.UploadDate?.ToString("yyyy-MM-dd"))</dd>
                            <dt class="col-sm-3">Státusz</dt>
                            <dd class="col-sm-9">@DocumentDto.StatusDisplayNames[Model.Status.ToString()]</dd>
                            <dt class="col-sm-3">Feltöltötte</dt>
                            <dd class="col-sm-9">@Model.UploadedBy</dd>
                            <dt class="col-sm-3">Dokumentumtípus</dt>
                            <dd class="col-sm-9">@Model.DocumentTypeName</dd>
                            @if (Model.DocumentLinks != null && Model.DocumentLinks.Any())
                            {
                                <dt class="col-sm-3">Kapcsolódó linkek</dt>
                                <dd class="col-sm-9">
                                    <ul>
                                        @foreach (var link in Model.DocumentLinks)
                                        {
                                            <li>@link.ModuleId: @link.RecordId</li>
                                        }
                                    </ul>
                                </dd>
                            }
                        </dl>
                    </div>
                    <!-- History Tab -->
                    <div class="tab-pane fade" id="history_@Model.DocumentId" role="tabpanel" aria-labelledby="history-tab_@Model.DocumentId">
                        @if (Model.StatusHistory != null && Model.StatusHistory.Any())
                        {
                            <table class="table table-sm table-striped mt-3">
                                <thead>
                                    <tr>
                                        <th>Dátum</th>
                                        <th>Régi státusz</th>
                                        <th>Új státusz</th>
                                        <th>Módosította</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var history in Model.StatusHistory.OrderByDescending(h => h.ChangeDate))
                                    {
                                        <tr>
                                            <td>@history.ChangeDate.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                            <td>@DocumentDto.StatusDisplayNames[history.OldStatus.ToString()]</td>
                                            <td>@DocumentDto.StatusDisplayNames[history.NewStatus.ToString()]</td>
                                            <td>@history.ChangedBy</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        }
                        else
                        {
                            <p class="mt-3">Nincs változási előzmény ehhez a dokumentumhoz.</p>
                        }
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Bezárás</button>
            </div>
        </div>
    </div>
</div>